<!DOCTYPE html>
<html>
    <head>
        <title> Shahafster </title>
        <meta charset = utf-8 />
        <meta name = "viewport" content = "width=device-width, initial-scale=1">

        <!-- JQUERY LINKS AND CONNECTIONS -->
        <script src = "https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity = "sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin = "anonymous"> </script>
        <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"> </script>         
        <!-- <script src = "/Library/WebServer/Documents/web-projects/shahafster/node_modules/jquery/src/jquery.js"></script> -->
        <script type="text/javascript" src = "./node_modules/jquery/src/jquery.js"></script>
        <!-- FONT LIBRARY ACCESS LINK -->
        <script src="https://kit.fontawesome.com/e7abc33a63.js" crossorigin="anonymous"></script>
   
        <!-- ALERTIFY LIBRARY ACCESS LINKS -->
        <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.rtl.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.rtl.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.rtl.min.css"/>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.rtl.min.css"/>

        <!-- MY CSS FILE -->
        <link rel = "stylesheet" type = "text/css" href = "main.css">

        <!-- MY JAVASCRIPT FILE -->
        <script src = "main.js"></script>
    </head>

    <body>
        <div class = "container">
            <div class = "upper">
                <button class = "menu" id = "manage-menu-btn" onclick = "slideSidebar()"> <i class = "fas fa-bars"></i> </button>
                <a href = "index.html"> <img src = "attachments/logo_001.png" /> </a>
            </div>
            <div id = "content">
                <div id = "sidebar-menu" class = "sidebar-close-animation">
                    <button class = "menu-option" id = "menu-btn-posts" onclick = "show_section(this.id.substring(9, this.id.length)); show_posts();" > Posts </button>
                    <button class = "menu-option" id = "menu-btn-labels" onclick = "show_section(this.id.substring(9, this.id.length)); show_labels();"> Labels </button>
                    <button class = "menu-option" id = "menu-btn-users" onclick = "show_section(this.id.substring(9, this.id.length))"> Users </button>
                    <button class = "menu-option" id = "menu-btn-tags" onclick = "show_section(this.id.substring(9, this.id.length))"> Tags </button>
                </div>
                
                <div id = "sections">
                    <div id = "posts" style = "display: block" name = "section">
                        <div id = "post-prompter">
                            <h3> Submit New Post !</h3>
                            </br>
                
                            <textarea id = "new-post-text" placeholder = "Add New Post!" rows = "7"></textarea>
                            <br/>
                            <div id = "new-post-label-selection">
                                <!-- TO BE POOPULATED WITH PHP -->
                            </div>
                            <br/>
                            <div id = "new-post-emoji-selection">
                                
                                <input type="radio" name = "moji" id = "moji_01" value = "128514" class = "moji-choice"/>
                                <label for = "moji_01">	&#128514;</label>

                                <input type="radio" name = "moji" id = "moji_02" value = "128517" class = "moji-choice"/>
                                <label for = "moji_02">	&#128517;</label>

                                <input type="radio" name = "moji" id = "moji_03" value = "128526" class = "moji-choice" checked/>
                                <label for = "moji_03">	&#128526;</label>

                                <input type="radio" name = "moji" id = "moji_04" value = "128542" class = "moji-choice"/>
                                <label for = "moji_04">	&#128542;</label>

                                <input type="radio" name = "moji" id = "moji_05" value = "128545" class = "moji-choice"/>
                                <label for = "moji_05">	&#128545;</label>

                            </div>
                            <br/>
                            <div class = "input-file-container">
                                <input id = "new-post-file" class = "new-post-file" type = "file" name = "new-post-file" />
                                <label for = "new-post-file"> Choose File </label>
                                <button class = "green" id = "new_post_submit" onclick = "submit_new_post()">Submit </button>
                            </div>                        
                        </div>
                        <h3 class = "edi-posts" style = "font-family: 'Gill Sans';"> Edit Posts!</h3>

                        <div id = "populated-posts">
                            <!-- TO BE POPULATED BY PHP -->
                        </div>
                    </div>
        
                    <div id = "labels" style = "display: hidden" name = "section">
                        <div id = "label-prompter">
                            <h3> Add New Label !</h3>
                            </br>
                            <input id = "new-label-text" type = "text" placeholder = "Name"  />
                            </br>
                            &nbsp;
                            <div class = "input-submission-container">
                                <input id = "new-label-color" type = "color" onchange = "update_presentation_color()" />
                                <label for = "new-label-color" id = "new-label-color-label"> Select Color </label>
                                <button class = "green" id = "submit_new_label" onclick = "submit_new_label(document.getElementById('new-label-text').value, document.getElementById('new-label-color').value)"> <i class = "fa fa-check"></i></button>
                            </div>
                            
                        </div>
                        <div id = "populated-labels">
                            <!-- TO BE POPULATED BY PHP AND AJAX -->
                        </div>
                    </div>
        
                    <div id = "users" style = "display: none" name = "section">
        
                    </div>
        
                    <div id = "tags" style = "display: none" name = "section">
        
                    </div>
                </div>
            </div>

            
        </div>
    </body>
    
    <script>
        // ----------------- POPULATION FUNCTIONS ------------------
        function show_posts() {
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "populate-posts-backend"
                },
                success: function(data) {
                    $("#populated-posts").html(data);
                }
            });
        }
        
        function show_labels() {
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "populate-labels"
                },
                success: function(data) {
                    $("#populated-labels").html(data);
                }
            });
        }

        function update_presentation_color() {
            var newcolor = document.getElementById("new-label-color").value;
            var colorpickerlabel = document.getElementById("new-label-color-label");
            colorpickerlabel.style.color = newcolor;
            colorpickerlabel.style.backgroundColor = newcolor;
            colorpickerlabel.style.borderColor = newcolor;
            
        }
        
        // --------- POST ACTIONS ------------
        function show_likes(postid) { // TODO
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "show-likes-from-postid",
                    id: postid
                },
                success: function(data) {
                    console.log(data)
                    alertify.alert(
                        'Users Likes - Post #' + postid, 
                        data,
                        function() {
                            console.log("CLOSE LIKES SHOWN");
                        }
                    );
                }
            });
        }

        async function get_text_from_postid(postid) {
            d = "NOT-FETCHED"
            await $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "get-text-from-postid",
                    id: postid
                },
                success: function(data) {
                    d = data
                }
            });
            return d
        }

        async function edit_post(postid) {
            posttext = await get_text_from_postid(postid);
            alertify.prompt(
                '>> EDIT POST ',
                'Edit Post ' + postid,
                posttext, 
                function(evt, value) {
                    $.ajax({
                        type: "POST",
                        url: "main.php",
                        data: {
                            message: "edit-post",
                            id: postid,
                            text: value
                        },
                        success: function(data) {
                            $("#populated-posts").html(data);
                        }
                    });
                },
                function() {
                    alertify.error("CANCEL")
                }
            );
            
        }

        function delete_post(postid) {
            console.log("DELETING POST" + postid)
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "delete-post",
                    id: postid
                },
                success: function(data) {
                    $("#populated-posts").html(data);
                }
            });
        }
        
        // -------- SUBMIT NEW DATA ------------
        function submit_new_label(text, color_passed) {
            if (text.length < 2) {
                alertify.warning("Label Name Must be 2 characters or longer!");
            } else {
                $.ajax({
                    type: "POST",
                    url: "main.php",
                    data: {
                        message: "new-label",
                        name: text,
                        color: color_passed
                    },
                    success: function(data) {
                        $("#populated-labels").html(data);
                        document.getElementById("new-label-text").value = "";
                        document.getElementById("new-label-color").value = "#000000";
                    }
                });
            }
            
        }
        
        function submit_new_post() {
            var texttopost = document.getElementById('new-post-text').value;
            var postmoji = ($("input[type=radio][name=moji]:checked").val());
            var postlabel = ($("input[type=radio][name=label]:checked").val());

            var media_final = "False"
            // if(document.getElementById("new-post-file").value == "") {
            //     var media_final = "FALSE";
            // } else {
            //     var file_data = $('#new-post-file').prop('files')[0]
            //     var media_final = new FormData()
            //     media_final.append('file', file_data)
            // }

            if (texttopost.length < 3) {
                alertify.warning ("Submission Text must contain at least 3 characters!");
                return;
            } else {
                $.ajax({
                    type: "POST",
                    url: "main.php",
                    data: {
                        message: "submit-new-post",
                        text: texttopost,
                        moji: postmoji,
                        label: postlabel,
                        media: media_final
                    },
                    success: function(data) {
                        document.getElementById('new-post-text').value = ""; //reset textarea
                        alertify.success("New Post Submitted!");
                        $("#populated-posts").html(data);
                        // console.log("Successfully Posted New Post to DB");
                    }
                });
            }
            
        }

        // -------- SHOW MENU OPTION BUTTONS IN ALERTIFY ------------
        var sidebarShown = true;
        function slideSidebar() {
            var sidebar = document.getElementById("sidebar-menu");
            var sections = document.getElementById("sections"); 
            if (sidebarShown) {
                sidebar.className = "sidebar-open-animation";
                sections.className = "sections-with-sidebar";
            }
            else {
                sidebar.className = "sidebar-close-animation";
                sections.className = "sections-without-sidebar";
            }
            sidebarShown = !sidebarShown;
        }

       
        // -------- SHOW MENU SELECTED SECTION ------------
        function show_section(sectionid) {
            var sections = document.getElementsByClassName("section");
            for (i = 0; i < sections.length; i++) {
                sections[i].style.display = "none";
            }
            document.getElementById(sectionid).style.display = "block";
        }

        function populate_labels() {
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "populate-labels"
                },
                success: function(data) {
                    $("#blog").html(data)
                }
            });
        }


        // --------- ASSIST FUNCTIONS ------------------
        alertify.minimalDialog || alertify.dialog('minimalDialog',function(){
            return {
                main:function(content){
                    this.setContent(content); 
                }
            };
        });

        $(document).ready(function() {
            // ---- POPULATE POSTS TO EDIT
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "populate-posts-backend"
                },
                success: function(data) {
                    $("#populated-posts").html(data)
                }
            });


            // ---- POPULATE LABELS FOR NEW POST
            $.ajax({
                type: "POST",
                url: "main.php",
                data: {
                    message: "populate-labels-for-new-post"
                },
                success: function(data) {
                    $("#new-post-label-selection").html(data)
                }
            });


        });


    </script>
</html>